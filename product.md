# 背单词配对游戏 - 产品需求文档

## 一、项目概述

### 1.1 产品定位
一款帮助用户记忆英语单词的网页游戏，通过中英文配对的方式，结合熟练度算法，提升单词记忆效果。

### 1.2 技术实现
- 单个 HTML 文件实现（包含 HTML/CSS/JavaScript）
- 适配移动端屏幕
- 使用 LocalStorage 进行数据持久化
- 使用 Bootstrap 5.3 

### 1.3 核心目标
通过游戏化的配对方式，让用户在轻松愉快的氛围中记忆单词，并根据熟练度智能调整单词出现频率，提高学习效率。

---

## 二、核心功能

### 2.1 游戏主界面

#### 2.1.1 布局设计
- **倒计时条**：位于页面顶部，显示答题倒计时（60秒）
- **左右两列布局**
  - 左列：中文单词列表
  - 右列：对应的英文单词列表
- **候选词数量**：每列最多显示 5 个单词（适配手机屏幕）
- **响应式设计**：优先适配移动端，兼顾桌面端体验

#### 2.1.2 交互逻辑
**基础交互：**
- 用户可以先点击中文或先点击英文（任意顺序）
- 点击后该单词高亮显示（表示已选中）
- 第二次点击另一个单词进行配对

**配对成功：**
1. 配对的两个单词立即释放格子（逻辑上标记为空位）
2. UI显示变为空心带框的灰色样式（文字仍显示但变灰，保持占位）
3. 倒计时立即重置为 60 秒
4. 记录正确次数，更新熟练度
5. 新单词加入待显示队列
6. 延迟2秒后开始填充新单词：
   - 从队列中取出单词，随机选择空位
   - 每个单词填充后间隔200ms再填充下一个
   - 逐个显示，形成渐进式的视觉效果
7. 在延迟期间，用户可以继续配对其他单词（累积多个空位）
8. UI 更新采用平滑动画过渡，无闪烁闪动

**重要说明**：新单词补充时的队列机制（v1.8 优化）：

**核心机制**：
- 维护两个独立的待显示队列：
  - 中文待显示队列：存储需要显示的中文单词
  - 英文待显示队列：存储需要显示的英文单词
- 配对成功后立即释放格子，UI显示为空心灰框

**具体实现流程**：
1. **单词配对成功后**：
   - 立即将配对的格子标记为空位（逻辑释放）
   - UI变为空心带框的灰色样式（视觉上保持占位）
   - 选择新单词并加入待显示队列
   - 启动延迟定时器（2秒）

2. **空位累积机制**：
   - 配对成功立即产生空位（不等待）
   - 在2秒延迟期间，用户可继续配对
   - 累积多个空位和多个待显示单词

3. **渐进填充算法**：
   ```
   延迟2秒后开始处理：

   渐进填充流程：
   - 每次处理一对单词（中文和英文）
   - 从中文队列中随机选择一个单词
   - 从中文空位中随机选择一个位置填充
   - 从英文队列中随机选择一个单词
   - 从英文空位中随机选择一个位置填充
   - 等待200ms
   - 继续处理下一对，直到队列为空

   视觉效果：
   - 新单词逐个淡入，而不是同时出现
   - 形成流畅的渐进式填充效果
   ```

4. **UI样式变化**：
   - 配对成功：立即变为空心灰框（border: 2px dashed #ccc），文字变灰但仍可见
   - 新单词填充：淡入动画恢复正常样式，逐个显示
   - 保持格子占位，避免布局跳动

4. **关键点**：
   - 中英文队列完全独立处理
   - 每次处理队列时都要重新随机排序
   - 空位选择也是随机的
   - 支持同时处理多个配对成功的情况（队列中可能有多个单词）

**算法优势**：
- 避免新单词总是出现在固定位置
- 中英文位置完全随机且独立
- 支持批量处理多个同时出现的空位
- 增加游戏的不可预测性和挑战性

**配对错误：**
1. 配对的两个单词变红并闪动（震动效果）
2. 0.3秒后恢复原状，取消选中
3. 记录错误次数，降低熟练度
4. 连续答错计数 +1

**游戏模式：**
- 无尽模式：游戏可以一直进行，单词循环出现

#### 2.1.3 倒计时机制
**倒计时设置：**
- **时长**：60 秒
- **显示位置**：页面顶部
- **样式**：进度条形式，从满格到空
- **警告提示**：
  - 剩余 10 秒时，进度条变为橙色
  - 剩余 5 秒时，进度条变为红色并闪烁

**倒计时规则：**
- 游戏开始时启动倒计时
- 每次成功配对后，倒计时立即重置为 60 秒
- 倒计时归零时，触发刷新机制

**超时处理：**
1. 倒计时归零时，暂停游戏
2. 显示提示："时间到！换一批单词"
3. 当前 5 对单词全部替换为新单词
4. 倒计时重置为 60 秒，重新开始
5. 超时不计入答错统计

#### 2.1.4 连续答错刷新机制
**触发条件：**
- 用户连续答错 3 次（不包括超时）

**刷新流程：**
1. 触发时显示提示："换个思路试试？"
2. 当前 5 对单词全部替换为新单词
3. 连续答错计数重置为 0
4. 连续答对计数重置为 0
5. 倒计时重置为 60 秒

**数据处理：**
- 答错的单词熟练度 -1（按原规则）
- 被刷新掉的未配对单词不计入统计
- 总答错次数正常累加

---

### 2.2 词库系统

#### 2.2.1 分级标准
| 等级 | 名称 | 词汇量 | 适用对象 |
|------|------|--------|----------|
| Level 1 | 基础词汇 | 300-500词 | 小学常用词 |
| Level 2 | 进阶词汇 | 800-1000词 | 初中核心词 |
| Level 3 | 中级词汇 | 1500-2000词 | 高中/大学四级 |
| Level 4 | 高级词汇 | 2000+词 | 大学六级/考研 |

#### 2.2.2 词库结构
**JSON 文件结构** (`data/words.json`)：
```json
{
  "1": [
    {
      "english": "hello",
      "chinese": "你好"
    }
  ],
  "2": [
    {
      "english": "beautiful",
      "chinese": "美丽的"
    }
  ],
  "3": [
    {
      "english": "abandon",
      "chinese": "放弃"
    }
  ],
  "4": [
    {
      "english": "abate",
      "chinese": "减轻"
    }
  ]
}
```

**内存中的单词数据结构**：
```javascript
{
  id: 1,
  english: "hello",
  chinese: "你好",
  level: 1,
  proficiency: 0, // 熟练度：0-陌生, 1-认识, 2-熟悉, 3-掌握
  correctCount: 0, // 答对次数
  wrongCount: 0, // 答错次数
  lastSeen: timestamp, // 上次出现时间
  nextReview: timestamp // 下次复习时间
}
```

#### 2.2.3 难度选择
- 用户首次进入游戏时，可选择起始难度（Level 1-4）
- 可在设置中切换难度等级
- 难度选择页面可点击每个等级查看该等级的全部单词信息

---

### 2.3 熟练度机制（核心算法）

#### 2.3.1 熟练度等级
- **Level 0 - 陌生**：从未见过或多次答错
- **Level 1 - 认识**：答对 1-2 次
- **Level 2 - 熟悉**：答对 3-5 次
- **Level 3 - 掌握**：答对 6 次以上且正确率 > 80%

#### 2.3.2 出现频率规则
根据熟练度调整单词出现的间隔轮次：

| 熟练度 | 出现频率 | 间隔轮次 |
|--------|----------|----------|
| 陌生 (0) | 高频 | 每 3-5 轮 |
| 认识 (1) | 中频 | 每 8-10 轮 |
| 熟悉 (2) | 低频 | 每 15-20 轮 |
| 掌握 (3) | 复习 | 每 30-50 轮 |

**注**：一轮 = 成功配对 5 个单词

#### 2.3.3 升降级规则
**升级条件：**
- 连续答对 3 次 → 熟练度 +1
- 最高为 Level 3（掌握）

**降级条件：**
- 答错 1 次 → 熟练度 -1
- 最低为 Level 0（陌生）
- 答错后该单词会提前出现（重置复习时间）

#### 2.3.4 单词选择算法
每次需要补充新单词时：
1. 优先选择到期需要复习的单词（nextReview <= now）
2. 其次选择熟练度低的单词
3. 确保屏幕上的 5 个单词不重复
4. 同一个单词不会在短时间内重复出现

---

### 2.4 统计数据页面

#### 2.4.1 整体统计
- **学习时长**：累计游戏时长
- **总答题数**：答对 + 答错的总次数
- **正确率**：答对次数 / 总答题数 × 100%
- **连续答对记录**：历史最高连续答对次数
- **超时次数**：累计触发倒计时刷新的次数
- **刷新次数**：累计触发连续答错刷新的次数

#### 2.4.2 词汇掌握情况
按熟练度分类统计：
- 陌生单词数量
- 认识单词数量
- 熟悉单词数量
- 掌握单词数量

可视化展示：饼图或进度条

#### 2.4.3 学习曲线
- 最近 7 天的答题数量
- 最近 7 天的正确率变化

可视化展示：折线图（可选）

#### 2.4.4 单词列表
- 按熟练度筛选查看单词
- 显示每个单词的详细数据：
  - 英文/中文
  - 答对/答错次数
  - 正确率
  - 熟练度等级

---

### 2.5 数据持久化

#### 2.5.1 存储方案
使用 LocalStorage 存储以下数据：

**用户设置：**
```javascript
{
  currentLevel: 1, // 当前选择的难度
  theme: "light" // 主题（可选）
}
```

**单词数据：**
```javascript
{
  words: [
    // 所有单词的熟练度数据
  ]
}
```

**统计数据：**
```javascript
{
  totalCorrect: 0,
  totalWrong: 0,
  totalPlayTime: 0,
  maxStreak: 0,
  currentStreak: 0,
  timeoutCount: 0, // 超时次数
  refreshCount: 0, // 连续答错刷新次数
  dailyStats: {
    "2026-01-31": {
      correct: 10,
      wrong: 2
    }
  }
}
```

#### 2.5.2 数据同步
- 每次答题后实时更新数据
- 每次页面关闭前保存数据
- 支持数据导出/导入（可选功能）

---

## 三、页面结构

### 3.1 页面导航
- **游戏页**：主要游戏界面
- **统计页**：数据统计与分析
- **设置页**：难度选择、数据清空等（可选）

### 3.2 交互流程
```
启动游戏
  ↓
首次进入？
  ├─ 是 → 选择难度 → 进入游戏
  └─ 否 → 直接进入游戏（使用上次难度）
  ↓
游戏进行中
  ├─ 点击配对
  ├─ 查看统计
  └─ 调整设置
```

---

## 四、视觉设计（待定）

### 4.1 设计风格
- 简洁清爽（可选：可爱风格）
- 适合长时间使用，避免视觉疲劳

### 4.2 色彩方案
- 主题色：（待定）
- 成功色：绿色系
- 错误色：红色系
- 中性色：灰色系

### 4.3 动画效果
- 配对成功：淡出动画
- 配对错误：抖动 + 闪烁
- 新词出现：淡入动画
- 倒计时条：平滑递减动画
- 倒计时警告：颜色过渡 + 闪烁效果
- 过渡时间：0.3-0.5秒

---

## 五、可选功能（优先级较低）

### 5.1 音效
- 配对成功音效
- 配对错误音效
- 背景音乐（可关闭）

### 5.2 成就系统
- 连续答对 10 次
- 单日答对 100 题
- 掌握 100 个单词

### 5.3 每日目标
- 设置每日答题目标
- 打卡记录

### 5.4 分享功能
- 生成学习报告卡片
- 分享到社交媒体

---

## 六、技术实现要点

### 6.1 性能优化
- 使用虚拟列表渲染（如果词库很大）
- 防抖处理点击事件
- LocalStorage 数据压缩

### 6.2 兼容性
- 移动端浏览器：iOS Safari、Android Chrome
- 桌面端浏览器：Chrome、Firefox、Safari、Edge

### 6.3 安全性
- LocalStorage 数据验证
- 防止作弊（时间戳校验）

---

## 七、开发计划（建议）

### Phase 1 - MVP（最小可行产品）
- [ ] 基础配对游戏界面
- [ ] 左右两列布局
- [ ] 倒计时条（60秒）
- [ ] 配对成功/失败交互
- [ ] 固定词库（Level 1，50-100 词）
- [ ] LocalStorage 基础存储

### Phase 2 - 核心功能
- [ ] 熟练度算法实现
- [ ] 单词出现频率调整
- [ ] 难度选择功能
- [ ] 超时刷新机制
- [ ] 连续答错刷新机制（3次）
- [ ] 完整词库（Level 1-4）

### Phase 3 - 数据统计
- [ ] 统计页面
- [ ] 答题数据记录
- [ ] 单词掌握情况展示
- [ ] 数据可视化

### Phase 4 - 优化与扩展
- [ ] 视觉美化
- [ ] 动画效果优化
- [ ] 音效（可选）
- [ ] 成就系统（可选）

---

## 八、附录

### 8.1 词库示例
**`data/words.json` 文件示例：**
```json
{
  "1": [
    { "english": "hello", "chinese": "你好" },
    { "english": "goodbye", "chinese": "再见" },
    { "english": "thank you", "chinese": "谢谢" },
    { "english": "sorry", "chinese": "对不起" },
    { "english": "please", "chinese": "请" }
  ],
  "2": [
    { "english": "beautiful", "chinese": "美丽的" },
    { "english": "important", "chinese": "重要的" }
  ],
  "3": [],
  "4": []
}
```

### 8.2 文件结构
```
english-word-games/
├── index.html          # 主HTML文件
├── data/
│   └── words.json      # 单词词库JSON文件
└── product.md          # 需求文档
```

### 8.2 参考资料
- 艾宾浩斯遗忘曲线
- Anki 间隔重复算法
- SuperMemo SM-2 算法

---

**文档版本**：v1.8.1
**最后更新**：2026-01-31
**撰写人**：Claude Code

**更新日志：**
- v1.8.1 (2026-01-31)：延长新单词出现时间至2秒，让用户有更多时间累积多个配对
- v1.8 (2026-01-31)：优化空位机制，配对成功立即释放格子，UI显示为空心灰框，延迟后随机填充
- v1.7 (2026-01-31)：新增队列机制，新单词通过队列管理并随机排序后分配到空位
- v1.6 (2026-01-31)：优化新单词位置随机性（中英文独立随机选择空位）
- v1.5 (2026-01-31)：新单词填充空位（随机选择空位）、词库JSON文件存储、难度选择可查看全部单词
- v1.4 (2026-01-31)：新单词随机位置补充（不与消失单词位置一致）
- v1.3 (2026-01-31)：优化UI交互（仅替换单个卡片，无闪烁）
- v1.2 (2026-01-31)：优化配对成功机制（新单词延迟2秒出现、倒计时重置）
- v1.1 (2026-01-31)：新增倒计时机制、连续答错刷新机制
- v1.0 (2026-01-31)：初始版本
